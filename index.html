<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"></meta>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

	<script>
		
		(function(d, s, id){
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) {return;}
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		
		var PicData;
		function GetData(){

			$.ajax({
				type : "GET",
				url : "https://graph.facebook.com/me?fields=id,photos&access_token="+AccessToken,
				async : true,
				cache : false,
				success : function(data){
					PicData = data;
					$('#loginBtn').hide();
					$('#gData').hide();
					$.post("analyze_people.php",{data:PicData},
					function(data){
						GetPics(data);
					});
					
				},
				error: function(XMLHttpRequest, textStatus, errorThrown){
					console.log("error: " + textStatus + "(" + errorThrown + ")");
				}
			});
		}

		function GetPics(data){
			var jdata = JSON.parse(data);
			for(var key in jdata){
				if(jdata.hasOwnProperty(key)){
					console.log(jdata[key].id);
				}
			
				$.ajax({
					type : "GET",
					url : "https://graph.facebook.com/"+jdata[key].id+"?fields=id,picture&access_token="+AccessToken,
					async : true,
					cache : false,
					success : function(data){
						$.post("get_profile_pics.php",{data:data},
						function(data){
							console.log(data);	
						});
					},
					error: function(XMLHttpRequest, textStatus, errorThrown){
						console.log("error: " + textStatus + "(" + errorThrown + ")");
					}
				});


			}
		
	
		}

		var AccessToken = "";
		var UserID = "";
		window.fbAsyncInit = function() {
			FB.init({
				appId : '1398459810400805',
				xfbml : true,
				version : 'v2.2',
				oauth : true
			});
			FB.getLoginStatus (function (response){
					if(response.status == "connected"){
						AccessToken = response.authResponse.accessToken;
						UserID = response.authResponse.userID;
						console.log(AccessToken);
						console.log("user id :"+UserID);
					}
			});
			FB.login(function(response){
				if(response.authResponse){
				}else{
					alert("canceled");
				}
			},{
				scope: 'publish_actions,publish_stream,email,public_profile,read_stream,user_photos',
				return_scopes:true
			});
		};
	</script>
	<script>
		function mv2gf(){
			var tempName = $('#bf>option:selected').text();
			if(tempName == "")
				return;
			//console.log(tempName);
			$("#bf :selected").remove();
			$('#gf').append('<option>'+tempName+'</option>');
			
		}
		function mv2bf(){
			var tempName = $('#gf>option:selected').text();
			if(tempName == "")
				return;
			$("#gf :selected").remove();
			$('#bf').append('<option>'+tempName+'</option>');
		}
		$(function(){
			$("#bf.option").draggable({cancel:false});
			$("#gf.option").draggable({cancel:false});
			
		});
	</script>
</head>
<body>
	<div class="container">
		<div class="row">
			<div id="fb-root"></div>
			<div class="jumbotron">
				<h1><small>This is</small> YoDo <small>in MeiChu Hackathon!</small></h1>
			</div>
		</div>
		<div id="loginBtn" class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="true" data-auto-logout-link="true">
		</div>
		<div id="gData"><button onclick="GetData()" type="button" class="btn btn-primary">Hit me</button></div>
		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">friends u like most</h3>
				</div>
				<div class="panel-body">
					<div class="col-md-4">
						<ul id="bf" class="list-group">
							<li>1</li>
							<li>2</li>
							<li>3</li>
						</ul>
					</div>
					<div class="col-md-4">
						<center>
						<button style="line-height:3;" class="btn btn-info" onclick="mv2bf()"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span></button>
						<button style="line-height:3;" class="btn btn-info" onclick="mv2gf()"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>
						</center>

					</div>
					<div class="col-md-4">
						<ul id="gf" class="list-group">
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
		</div>
	</div>
</body>
</html>
